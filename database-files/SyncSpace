-- Drop and create the database
DROP DATABASE IF EXISTS SyncSpace;
CREATE DATABASE IF NOT EXISTS SyncSpace;

USE SyncSpace;

-- Create table for City Community
CREATE TABLE IF NOT EXISTS CityCommunity (
    CommunityID INT AUTO_INCREMENT PRIMARY KEY,
    Location VARCHAR(100)
);

-- Create table for Housing
CREATE TABLE IF NOT EXISTS Housing (
    HousingID INT AUTO_INCREMENT PRIMARY KEY,
    Availability VARCHAR(50),
    Style VARCHAR(50),
    Location VARCHAR(100)
);

-- Create table for Interest Group
CREATE TABLE IF NOT EXISTS InterestGroup (
    GroupID INT AUTO_INCREMENT PRIMARY KEY,
    Description TEXT,
    GroupName VARCHAR(100)
);

-- Create table for Ticket (needed before SystemHealth and SystemLog)
CREATE TABLE IF NOT EXISTS Ticket (
    TicketID INT AUTO_INCREMENT PRIMARY KEY,
    UserID INT,
    IssueType VARCHAR(50),
    Status VARCHAR(50),
    Priority VARCHAR(50),
    ReceivedDate DATE,
    ResolvedDate DATE
);

-- Create table for User
CREATE TABLE IF NOT EXISTS User (
    UserID INT AUTO_INCREMENT PRIMARY KEY,
    ChatID INT,
    Name VARCHAR(100),
    Email VARCHAR(100),
    Role VARCHAR(50),
    PermissionsLevel VARCHAR(50)
);

-- Create table for Chat
CREATE TABLE IF NOT EXISTS Chat (
    ChatID INT AUTO_INCREMENT PRIMARY KEY,
    SenderID INT,
    ReceiverID INT,
    Content TEXT,
    Time TIMESTAMP,
    SupportStaffID INT,
    FOREIGN KEY (SenderID) REFERENCES User(UserID),
    FOREIGN KEY (ReceiverID) REFERENCES User(UserID)
);

-- Create table for Student
CREATE TABLE IF NOT EXISTS Student (
    StudentID INT AUTO_INCREMENT PRIMARY KEY,
    Name VARCHAR(100),
    Major VARCHAR(100),
    Company VARCHAR(100),
    Location VARCHAR(100),
    HousingStatus VARCHAR(50),
    CarpoolStatus VARCHAR(50),
    Budget DECIMAL(10, 2),
    LeaseDuration VARCHAR(50),
    Cleanliness VARCHAR(50),
    Lifestyle VARCHAR(50),
    CommuteTime INT,
    CommuteDays INT,
    Interests TEXT,
    CommunityID INT,
    HousingID INT,
    GroupID INT,
    FeedbackID INT,
    ChatID INT,
    BrowseTo VARCHAR(100),
    FOREIGN KEY (CommunityID) REFERENCES CityCommunity(CommunityID),
    FOREIGN KEY (HousingID) REFERENCES Housing(HousingID),
    FOREIGN KEY (GroupID) REFERENCES InterestGroup(GroupID)
);

-- Create table for Community Post
CREATE TABLE IF NOT EXISTS CommunityPost (
    PostID INT AUTO_INCREMENT PRIMARY KEY,
    StudentID INT,
    CommunityID INT,
    Title VARCHAR(200),
    Date DATE,
    FOREIGN KEY (StudentID) REFERENCES Student(StudentID),
    FOREIGN KEY (CommunityID) REFERENCES CityCommunity(CommunityID)
);

-- Create table for Events
CREATE TABLE IF NOT EXISTS Events (
    EventID INT AUTO_INCREMENT PRIMARY KEY,
    CommunityID INT,
    Date DATE,
    Name VARCHAR(100),
    Description TEXT,
    FOREIGN KEY (CommunityID) REFERENCES CityCommunity(CommunityID)
);

-- Add foreign key to User table now that Chat is created
ALTER TABLE User
ADD FOREIGN KEY (ChatID) REFERENCES Chat(ChatID);

-- Create table for Feedback
CREATE TABLE IF NOT EXISTS Feedback (
    FeedbackID INT AUTO_INCREMENT PRIMARY KEY,
    Description TEXT,
    Date DATE,
    ProgressRating INT,
    StudentID INT,
    AdvisorID INT,
    FOREIGN KEY (StudentID) REFERENCES Student(StudentID)
);

-- Create table for Advisor
CREATE TABLE IF NOT EXISTS Advisor (
    AdvisorID INT AUTO_INCREMENT PRIMARY KEY,
    Name VARCHAR(100),
    Email VARCHAR(100),
    Department VARCHAR(100),
    StudentID INT,
    FOREIGN KEY (StudentID) REFERENCES Student(StudentID)
);

-- Add foreign key to Feedback for Advisor after Advisor is created
ALTER TABLE Feedback
ADD FOREIGN KEY (AdvisorID) REFERENCES Advisor(AdvisorID);

-- Create table for Task
CREATE TABLE IF NOT EXISTS Task (
    TaskID INT AUTO_INCREMENT PRIMARY KEY,
    Description TEXT,
    Reminder DATE,
    AssignedTo INT,
    DueDate DATE,
    Status VARCHAR(50),
    AdvisorID INT,
    FOREIGN KEY (AssignedTo) REFERENCES User(UserID),
    FOREIGN KEY (AdvisorID) REFERENCES Advisor(AdvisorID)
);

-- Create table for System Log
CREATE TABLE IF NOT EXISTS SystemLog (
    LogID INT AUTO_INCREMENT PRIMARY KEY,
    TicketID INT,
    Timestamp TIMESTAMP,
    Activity TEXT,
    MetricType VARCHAR(50),
    Privacy VARCHAR(50),
    Security VARCHAR(50),
    FOREIGN KEY (TicketID) REFERENCES Ticket(TicketID)
);

-- Create table for System Health
CREATE TABLE IF NOT EXISTS SystemHealth (
    SystemHealthID INT AUTO_INCREMENT PRIMARY KEY,
    LogID INT,
    Timestamp TIMESTAMP,
    Status VARCHAR(50),
    MetricType VARCHAR(50),
    FOREIGN KEY (LogID) REFERENCES SystemLog(LogID)
);

-- 1.4 
UPDATE Ticket
SET Priority = 'Critical'
WHERE TicketID = 1;

-- 2.5 
UPDATE Task
SET Status = 'Completed'
WHERE TaskID = 5;

-- 3.2 
INSERT INTO Student (Name, Major, Location, HousingStatus, Budget, Cleanliness, Lifestyle, CommuteTime, Interests)
VALUES (
    'Kevin Chen',
    'Data Science and Business',
    'San Jose, California',
    'Searching',
    1200.00,
    'Very Clean',
    'Quiet',
    30,
    'Hiking, Basketball, Technology'
);

-- 4.3 
INSERT INTO Housing (Style, Availability, Location)
VALUES ('Apartment', 'Available', 'New York City');
